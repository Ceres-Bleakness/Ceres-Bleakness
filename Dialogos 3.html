<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ceres: Bleakness - Los juegos de dios</title>
  <link rel="icon" type="image/png" href="./images/favicon.png"/>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: white;
    }

    body {
      background-image: url('./images/asteroides.jpg'); /* Reemplaza con tu imagen */
      background-size: cover;
      background-position: center;
      position: relative;
    }

    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      opacity: 1;
      transition: opacity 1s;
      pointer-events: none;
      z-index: 1;
    }

    #dialogo, #indicacion {
      position: relative;
      z-index: 2;
    }

    #dialogo {
      font-size: 24px;
      max-width: 80%;
      text-align: center;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 10px;
      margin: auto;
      margin-top: 30vh;
    }

    #indicacion {
      text-align: center;
      margin-top: 20px;
      font-size: 18px;
      opacity: 0.7;
      display: block;
    }

    .Omitir { 
        background-color: black;
       
        
        width:200px;
        height:100px ;
        color:whitesmoke;
        font-size: 30px;
     }

     #BotonOmitir{
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      margin-top: 400px ;
      margin-left: 650px ;
      opacity: 1;
      transition: opacity 1s;
      z-index: 1;

     }

  </style>
</head>
<body>

<div id="overlay"></div>
<div id="dialogo"></div>
<div id="indicacion">Presiona Enter para continuar...</div>
<div id="BotonOmitir"><button class="Omitir" onclick="location.href='Nivel3.html'">Omitir</button></div>
 

<audio id="audioFondo" src="./song/MusicaAmbientesD1.mp3" loop></audio>

<script>
  const dialogos = [
    { texto: "...", audio: "./song/.m4a"},
    { texto: "...", audio: "./song/Quejido2.m4a"},
    { texto: "Todavía respiro…", audio: "./song/P3-1.wav"},
    { texto: "No me vas a quebrar tan fácil.", audio: "./song/P2-1.m4a"},
    
    { texto: "¡Bravo!", audio: "./song/C3-1.wav" ,color: "#ff0000"},
    { texto: "¡Bravo, pequeño humano!", audio: "./song/C3-2.wav" ,color: "#ff0000"},
    { texto: "¡Has bailado con la muerte como un poeta en llamas!", audio: "./song/C3-3.wav" ,color: "#ff0000"},
    { texto: "Tu sufrimiento… ha sido exquisito.", audio: "./song/C3-4.wav" ,color: "#ff0000"},
    
    { texto: "¿Vienes a burlarte de nuevo?", audio: "./song/P3-2.wav"}, 
    
    { texto: "¡No!",audio: "./song/C3-5.wav" ,color: "#ff0000"},
    { texto: "Vengo a premiarte.", audio: "./song/C3-6.wav" ,color: "#ff0000"},
    { texto: "Tu voluntad ha sido un manjar inesperado… y ahora, quiero más.",audio: "./song/C3-7.wav" ,color: "#ff0000"},

    { texto: "¿Qué vas a hacer ahora?", audio: "./song/P3-3.wav"}, 
    
    { texto: "Lo mismo que haría cualquier narrador satisfecho con su protagonista…", audio: "./song/C3-8.wav", color: "#ff0000" },
    { texto: "¡Subir la apuesta!", audio: "./song/C3-9.wav", color: "#ff0000" ,quitarOscuridad: true},
    { texto: "...", audio: "./song/DistEspace.mp3", color: "#ff0000"},
    { texto: "Veamos cómo maniobras ahora, cuando la realidad se quiebre frente a ti.", audio: "./song/C3-10.wav", color: "#ff0000"},
    { texto: "Este sector del vacío ha sido… modificado", audio: "./song/C3-11.wav", color: "#ff0000"},
    { texto: "Los asteroides ya no siguen trayectorias lógicas", audio: "./song/C3-12.wav", color: "#ff0000"},
    { texto: "La gravedad ya no es constante y lo mejor: el tiempo será tu enemigo.", audio: "./song/C3-13.wav", color: "#ff0000"},
    
    { texto: "Estás loco…", audio: "./song/P3-4.wav"}, 
   
    { texto: "¿Loco?", audio: "./song/C3-14.wav", color: "#ff0000" },
    { texto: "No.Solo eterno y tu eres el eco más entretenido que he encontrado en eones", audio: "./song/C3-15.wav", color: "#ff0000" },
    { texto: "Ahora…", audio: "./song/C3-16.wav", color: "#ff0000" },
    { texto: "Vuelo nocturno, comandante. Que cada segundo sea puro terror.", audio: "./song/C3-17.wav", color: "#ff0000"},

    { texto: "...", audio: "./song/RadioOn.mp3"},
 
    { texto: "Piloto… estás haciendo un buen trabajo… mantén la calma… detecto una salida…", audio: "./song/BFR3-1.wav" ,color: "#0cb1f3"},

    { texto: "¡BFR! ¡Volviste!", audio: "./song/P3-5.wav"}, 

    { texto: "Queda poco… ya casi llegas al otro lado…", audio: "./song/BFR3-2.wav" ,color: "#0cb1f3"},

    { texto: "...", audio: "./song/RadioOff.mp3", color: "#ff0000" },
    { texto: "¿De verdad creíste que tendrías alguna salida?", audio: "./song/C3-18.wav", color: "#ff0000" },
    { texto: "¡Oh, humano, eres una joya trágica!", audio: "./song/C3-19.wav", color: "#ff0000" },

    { texto: "¡Maldito! ¡Te vas a arrepentir de esto!", audio: "./song/P3-6.wav"}, 

    { texto: "¿Oh si? Pues ya lo veremos pequeño, por ahora, céntrate en divertirme un rato", audio: "./song/C3-20.wav", color: "#ff0000" },
  ];

  let indiceDialogo = 0;
  let escribiendo = false;
  let fondoIniciado = false;
  let audioDialogoActual = null; // <<-- Aquí se guarda el audio activo

  const contenedorTexto = document.getElementById("dialogo");
  const indicacion = document.getElementById("indicacion");
  const overlay = document.getElementById("overlay");
  const fondoAudio = document.getElementById("audioFondo");

  async function reproducirDialogoActual() {
    if (escribiendo || indiceDialogo >= dialogos.length) return;

    // Detiene el audio anterior si existe
    if (audioDialogoActual) {
      audioDialogoActual.pause();
      audioDialogoActual.currentTime = 0;
    }

    escribiendo = true;
    contenedorTexto.innerHTML = "";
    indicacion.style.display = "none";

    const { texto, audio, quitarOscuridad, color } = dialogos[indiceDialogo];
    contenedorTexto.style.color = color || "white";

    if (quitarOscuridad) {
      overlay.style.opacity = "0";
    }

    // Reproduce el nuevo audio
    audioDialogoActual = new Audio(audio);
    audioDialogoActual.play().catch(e => console.warn("Audio bloqueado por el navegador:", e));

    for (let i = 0; i <= texto.length; i++) {
      contenedorTexto.innerHTML = texto.slice(0, i);
      await new Promise(resolve => setTimeout(resolve, 40));
    }

    escribiendo = false;
    indicacion.style.display = "block";
  }

  document.addEventListener("keydown", async (event) => {
    if (event.key === "Enter" && !escribiendo) {
      if (!fondoIniciado) {
        fondoAudio.play().catch(e => console.warn("Fondo bloqueado por el navegador:", e));
        fondoIniciado = true;
        fondoAudio.volume = 0.2;
      }

      indiceDialogo++;
      if (indiceDialogo < dialogos.length) {
        await reproducirDialogoActual();
      } else {
        // Detener también cualquier audio en reproducción antes de salir
        if (audioDialogoActual) {
          audioDialogoActual.pause();
          audioDialogoActual.currentTime = 0;
        }
        window.location.href = "Nivel3.html";
      }
    }
  });

  document.body.addEventListener("click", () => {
    if (indiceDialogo === 0) {
      fondoAudio.play().catch(() => {});
      fondoIniciado = true;
      reproducirDialogoActual();
    }
  }, { once: true });
</script>


</body>
</html>